// InvInq.cpp
// Armand Link
// 10/10/21

#include <iostream>
#include <iomanip>
#include <ctime>                        // Permits Use of Time
#include <cctype>                       // Permits use of toupper()
#include <string>                       // C-Strings and Strings
#include <limits>                       // Stream Limits

using namespace std;

// Class Declarations

// Specification B1 - Date class
class Date 
{
    private:
        int month;                              // Name of the Month
        int day_month;                          // Date of the Month
        int year;                               // Annual Year
    public:
    // Default Constructor - Uses System Date
    Date()
    {
        time_t unix_time = time(NULL);
        const tm* now = localtime(&unix_time);

        // Assigning the Memory Location of Private Variables to Current Time
        month = now->tm_mon + 1;
        day_month = now->tm_mday;
        year = now->tm_year + 1900;
    }
    // Parameterizer Constructor
    Date (int mm, int dd, int yy) // Get User Date
    {
        month = mm;
        day_month = dd;
        year = yy; 
    }

     // Member Function Prototypes
    void set_month(int mm){ month = mm;}        // Setter for Month
    void set_day(int dd) {day_month = dd;}      // Setter for Day
    void set_year(int yy) {year = yy;}          // Setter for Year
    void get_inventory_date();                  // Gets Date Added to Stock
    
    // Displays the Date in 9/99/99 Format
    string PrintDate()                            
    {
        string s = to_string(month) + "/" + to_string(day_month) + "/" 
                   + to_string(year).substr(2);
        return s;
    }
    void TestDate();                            // Class Component Test
};

    // Specification B2 - ComponentTest method in Date
    // ***Incomplete - Add at least two tests
    void Date::TestDate()
    {
       int mm = 99; 
       int dd = 99;
       int yy = 99;

        // Test #1 for System Time
        if (mm != this->month && dd != this->day_month && yy != this->year)
            cout << "\n\t\tSystem Time: " << right << setw(11) << "Passed";
        else
            cout << "\n\t\tSystem Time: " << right << setw(11) << "Failed";


        // Test #2 for Overridden Due Date
        if (month >= 1 && month <= 12){

            cout <<"\n\t\tMonth Status: " << right << setw(10) << "Passed";
        }
        else
            cout<< "\n\t\tMonth Status: " << right << setw(10) << "Failed";

        if (day_month >= 1 && day_month <= 31)
            cout << "\n\t\tDay Status: " << right << setw(12) << "Passed";
        else
            cout << "\n\t\tDay Status: " << right << setw(12) << "Failed";

        if (year >= 1900 && year <= 2021)
            cout << "\n\t\tYear Status: " << right << setw(11) << "Passed";
        else
            cout << "\n\t\tYear Status: " << right << setw(11) << "Failed";

    }

/*******************************************************************************
                        Item Stock Class Declaration 
                        (Contains Inventory Fields)
*******************************************************************************/
class Stock
{
    private:
        int id_number;                  // Item ID
        int on_hand_stock;              // Qty On Hand
        double distrib_price;           // Wholesale Cost
        double list_price;              // Retail Price
        Date inventory_date;            // Date Added to Inventory
        // Private Method to Set Date
        void set_user_date() 
        {
           int mm, dd, yy;

           cout << "\nNow, Enter the Date Item was Added to Inventory.";
           cout << "\n\nPlease press <Enter> after each calendar period:\n ";
           cout << "\n* Note: Use the Two Digit Format for Month and Day (99)\n";
           cout << "  and Four Digits for the Year (9999).";
           cout << "\n\nEnter the Inventory Month (mm): ";
           cin >> mm; 

           while (!( mm <= 12 && mm >= 1))
            {
                cout << "\nINVALID ENTRY. Only 12 Months on Current Calendar.";
                cout << "\nCan't Make Year End Slower or Faster.";
                cin.clear();                    // Clear Error Message
                cin.ignore(numeric_limits<streamsize>::max(), '\n');          
                cout << "\n\nPlease Enter a Valid Month (mm): ";
                cin >> mm;
            }   
            // Pointer to Date Class Method to Set Month
            this->inventory_date.set_month(mm);

           cout << "Enter the Inventory Day (dd): ";
           cin >> dd;

         while (!(dd <= 31 && dd >= 1))
            {
                cout << "\nINVALID ENTRY. Must Be a Day (1-31).";
                cout << "\nWouldn't more days be nice?";
                cin.clear();                    // Clear Error Message
                cin.ignore(numeric_limits<streamsize>::max(), '\n');          
                cout << "\n\nPlease Enter a Valid Day (dd): ";
                cin >> dd;
            }  
            // Pointer to Date Class Method to Set Day
            this->inventory_date.set_day(dd);

           cout << "Enter the Inventory Year (yyyy): ";
           cin >> yy;

           while (!( yy >= 1900 && yy <= 2021))
            {
                cout << "\nINVALID ENTRY. Year Must be Recent Past or Present.";
                cout << "\nNot the Future. Oh, Also - 4 Digits.";
                cin.clear();                    // Clear Error Message
                cin.ignore(numeric_limits<streamsize>::max(), '\n');          
                cout << "\n\nPlease Enter a Valid Year (yyyy): ";
                cin >> yy;
            }
            // Pointer to Date Class Method to Set Year
            this->inventory_date.set_year(yy);
            
        }
    public:
    // Default Inventory Constructor - Initialized to Blank Strings
    Stock()
    {     
        id_number = 0;
        on_hand_stock = 0;
        distrib_price = 0.00;
        list_price = 0.00;
    }

    // Shared Getter Method : Returns ID Stock Entry 
    int get_item_record_num()   
    { return id_number;}           

    // Getter for Item ID
    int get_id_num() {return id_number;}
    // Setter for Item ID                  
    void set_id_num(int x) {id_number = x;}    
                
    // Getter for Quantity on Hand
    unsigned int get_qty_on_hand() {return on_hand_stock;}
    //Setter for Quantity on Hand
    void set_qty_on_hand(unsigned int x) {on_hand_stock = x;}

    // Getter for List Price (Retail Cost) 
    double get_list_price() {return list_price;}
    // Setter for List Price (Retail Cost)
    double set_list_price();

    // Getter for Distributor Price (Wholesale Cost)
    double get_distrib_price() {return distrib_price;};
    // Setter for Distributor Price (Wholesale Cost)
    void set_distrib_price(double x)
    {
        // fixed >> showpoint >> setprecision(2.0);
        distrib_price = x;
        list_price = distrib_price * 2;
        
    }
    // Getter for Stock Date
    Date get_inventory_date() {return inventory_date;}
    void StockTest();                           // Class Component Test
    // Overloading for Dynamic User Storage Input
    friend istream& operator>> (istream& in, Stock& x);
    //Overloading Ostream for Dynamic Storage 
    friend ostream& operator<< (ostream& out, const Stock& x);
};

// Specification A3 - Overload operator>> 
// Reading In Stock Data from Overloaded Insertion Operator
istream& operator>> (istream& in, Stock& x)
{
    int id;
    int on_hand; 
    double whs_price;
    Date date;
    int mm = 9;
    int dd = 9;
    int yy = 99;

    cout << "\n\t\tID Number: "; 
    in >> id;

    // Specification B4 - Inventory Entry Input Validation
    while ( id < 10000 || id > 99999)
    {
        cout << "\nINVALID ENTRY. ID # Must Be 5 Digits (10000-99999).";
        cin.clear();                    // Clear Error Message
        cin.ignore(numeric_limits<streamsize>::max(), '\n');          
        cout << "\n\n\t\tID Number: ";
        in >> id;
    }
    x.set_id_num(id);      
                   
    cout << "\t\tQuantity: ";
    in >> on_hand;

    while (!cin || on_hand < 0)
    {
        cout << "\nMISSING SOMETHING? Quantity can't be zero or less.";
        cin.clear();                            
        cin.ignore(numeric_limits<streamsize>::max(), '\n');
        cout << "\n\n\t\tQty: ";
        in >> on_hand;
    }
    x.set_qty_on_hand(on_hand);    
                  
    cout << "\t\tWholesale Cost: $";
    cout << fixed << showpoint << setprecision(2);
    in >> whs_price;
   
   while (!cin || whs_price < 0)
    {
        cout << "\nSIGH. Alas, nothing in the world is less than free.";
        cin.clear();                            
        cin.ignore(numeric_limits<streamsize>::max(), '\n');                
        cout << "\n\n\t\tWholesale Cost: $";
        in >> whs_price;
    }
    x.set_distrib_price(whs_price);   

    cout << left << "\t\tRetail Cost: $";
    cout << x.get_list_price() << endl;         // Automatically calculated     

    // Setting User Date for Item 
    x.set_user_date(); 
    
    return in;
}
// Specification A2 - Overload operator«
// Makeshift Inventory Table with Output
ostream& operator<< (ostream& out, Stock& x)
{
        out << "| " << left << setw(5) << x.get_id_num() << "|";
        out << right << setw(13) << x.get_qty_on_hand() << "|";
        out << right << fixed << setw(12) << "$" << fixed << showpoint;
        out << setprecision(2) << x.get_distrib_price() << "|";
        out << right << setw(9) << "$" << x.get_list_price() << "|";
        out << right << setw(12) << x.get_inventory_date().PrintDate() << "|";
        
        // New Line for Chart
out << "\n-------------------------------------------------------------------\n";

        return out;
}
// Class Component Tests for Stock
void Stock::StockTest()
{
    

    // Checking Inventory Member Variables for Initialization
    if (id_number ==  0)
        cout <<"\n\t\tID Status: " << right << setw(13) << "Passed";
    else
        cout<< "\n\t\tID Status: " << right << setw(13) << "Failed";

    if (on_hand_stock == 0)
        cout <<"\n\t\tQty Status: " << right << setw(12) << "Passed";
    else
        cout<< "\n\t\tQty Status: " << right << setw(12) << "Failed";

    if (distrib_price == 0)
        cout <<"\n\t\tWholesale Cost: " << right << setw(8) << "Passed";
    else
        cout<< "\n\t\tWholesale Cost: " << right << setw(8) << "Failed";
    
     if (list_price == 0)
        cout <<"\n\t\tRetail Cost: " << right << setw(11) << "Passed";
     else
        cout<< "\n\t\tRetail Cost: " << right << setw(11) << "Failed";
    
    

}

/*----------------------------------------------------------------------------*/

/*******************************************************************************
                        Storage Inventory Class Declaration 
                (Dynamically Creates Space for Inventory)
*******************************************************************************/
class Storage
{
    private:
        int stock_size;                         // Current Stock Size
        int max_stock_size;                     // Max Items Allowed
        // Specification C2 - Dynamic Array
        Stock *arr_items;                  
        void build_stock_space();               // Increase Space as Needed 
        // Returns Index of Entry
        int find_item_record_num(int anID) const;   

    public:
        // Default Constructor 
        Storage()
        {
            max_stock_size = 5;
            stock_size = 0;
            arr_items = new Stock[max_stock_size];  
        };
        // Storage Destructor
        ~Storage()
        {
            delete [] arr_items;
        };

        // Member Function Prototypes
        
        void add_stock();                       // Adds New Stock Elements
        void remove_stock();                    // Removes Last Item from Stock
        void edit_stock();                      // Changes Item Records
        void display_stock() const;             // Displays Inventory Items
       
        
        void StorageTest();                     // Storage Component Test
        //Overloading for Dynamic Storage 
        friend ostream& operator<< (ostream& out, const Stock& x);
        // Overloading for Dynamic User Storage Input
        friend istream& operator>> (istream& in, Stock& x);
};


void Storage::add_stock()
{
      
      if(max_stock_size == stock_size)
      build_stock_space();
      
      cout << "\nEnter an ID #, Quantity, Wholesale Price, & Date Added.";
      cout << "\n(Retail Price will be calculated at 100% Wholesale)";
      cout << "\n\nPlease press <Enter> after each item category:\n ";

      // Reading in New Item Entry
      cin >> arr_items[stock_size++];

}
 // Specification C3 - Resize Array - add to end
void Storage::build_stock_space()
{ 
     max_stock_size = stock_size + 5;     
     
     Stock* new_items = new Stock[max_stock_size];
       
       for (int i = 0; i < stock_size; i++)
            new_items[i] = arr_items[i];

        delete [] arr_items;
        arr_items = new_items;
        new_items = nullptr;  
}
// Storage Method to Remove Last Element or Search by Record ID
void Storage::remove_stock()
{
    int anID;                       // Method Member Variable for Comparison
    char rmv_response;              // User Response
    
    while (stock_size == 0)
    {
        cout << "\nNOTHING TO SEE HERE. Press <A> to add stuff, or <Q> to quit.";
        exit(0); 
    }
    
    // Specification C4 - Resize Array - subtract from end
    cout << "\nThe most recent entry will be deleted. Are you sure?";
    cout << "\n(Enter 'Y' for Yes or 'N' for No): ";
    cin >> rmv_response;
    rmv_response = toupper(rmv_response);

    switch (rmv_response)
    {

        case 'Y':
        {
            Stock *temp = new Stock[stock_size - 1];
            for (int i = 0; i < stock_size - 1; i++)
                temp[i] = arr_items[i];

                delete [] arr_items;
                arr_items = temp;
                temp = nullptr;
                stock_size--;

        cout << "\nStock Item Deleted from Inventory." << endl;
        cout << "\n\nPlease choose an option (A, D, E, P, or Q to Quit): ";

        break;
        }
        case 'N':
        {
         cout << "\nPlease type the ID of entry to be removed, and press <Enter>: ";
         cin >> anID;

         int curr_entry = find_item_record_num(anID);

         if (curr_entry == -1)
         {
             cout << "\nHMM..." << anID << " was not found. Please check it.\n";
             /* cout << "\n\nChoose an option (A, D, E, P, or Q to Quit): "; */
             break;
         }
         else
         {
             for (int j = curr_entry + 1; j < stock_size; j++)
             arr_items[j-1] = arr_items[j];
             stock_size--;
             cout << "\nStock Item Deleted from Inventory." << endl;
         } 
        }
        default: 
        while (stock_size == 0)
            cout << "\nNOTHING TO SEE HERE. Press <A> to add stuff, or <Q> to quit.";
    }
}
// Specification A1 - Edit Inventory
void Storage::edit_stock()
{
    int anID;

    cout << "\nEnter the ID # of the item to modified (#####): ";
    cin >> anID;

    int curr_entry = find_item_record_num(anID);
    if (curr_entry == -1)
    {
        cout << "\nUH OH... Item # " << anID << " not found in current stock.";
        cout << endl;
        cout << "\n\nPlease choose an option (A, D, E, P, or Q to Quit): ";
    }
    else
    {
        cout << "\nEntry found for item: \n\n";
        cout << arr_items[curr_entry];

    cout << "\nPlease update the entry for this item: \n";
    cout << "Press <Enter> after each item category entry.\n";
    cin >> arr_items[curr_entry];

    }
}
// Search Storage Method for ID Record Number
int Storage::find_item_record_num(int anID) const
{
    for (int i = 0; i < stock_size; i++)
    // Compare User Entry with Records of ID Number
	if (arr_items[i].get_item_record_num() == anID)
		return i;		                    
    
    // Return if Not Found
    return -1;				        
}

void Storage::display_stock() const
{
    if (stock_size == 0)
    {
        cout << "\nNO CURRENT STOCK. Press <A> to add stuff, or <Q> to quit.";
        return; 
    }

    //  Header for Generated Stock
cout << "\n ------------------------------------------------------------------"; 
cout << "\n|  ID  | Qty on Hand | Wholesale Price | Retail Price | Date Added |";
cout << "\n ------------------------------------------------------------------\n";
 

    for (int i = 0; i < stock_size; i++)
        cout << left << arr_items[i];

}
// Storage Component Tests
void Storage::StorageTest()
{
    Storage t;

    if (arr_items != nullptr)
        cout <<"\n\t\tItems Array: " << right << setw(11) << "Passed" << endl;
    else
        cout <<"\n\t\tItems Array: "<< right << setw(11) << "Failed" << endl;
}
/*----------------------------------------------------------------------------*/

/******************************************************************************/


// Client Function Prototypes
void ProgramGreeting();
void displayStockMenu();                // Program Menu for User Input
char getStockInput();                   // Prompt
bool validateStockInput();              // Validates User Selected Option
char getValidStockOption();             //
void UnitTest();                        // Calls Class Component Tests


int main() 
{
    // Date date;                       // Local Object for Date Class
    char menu_option;                   // Local Variable for Menu 
    Storage x;                          // Local Object for Storage Class
    
    ProgramGreeting();

    // Specification A4 - UnitTest() method in main()
    UnitTest();

    displayStockMenu();

    // Switch Statement for Menu Options
    do
    {
        menu_option = getValidStockOption();
        switch (menu_option)
        {
            case 'A':
                x.add_stock();
                break;
            case 'D':
                x.remove_stock();
                break;
            case 'E':
                x.edit_stock();
                break;
            case 'P':
                x.display_stock();
                break;
            case 'Q':       break;
        }
    } while (menu_option != 'Q');
    

    // Farewell Message to User After Exiting Program
    if (menu_option == 'Q')
        {
            cout << "\nEasy as 1, 2, You & Me ♥\n" << endl;  
            cout << "Goodbye!";
        }

    return 0;
}

void ProgramGreeting()
{
    Date();
    Date set_date(10, 10, 2021);

    cout << "\n                         @@@@@@@@\n";                                    
    cout << "                     @@@@@@@@@@@@@@@@\n";
    cout << "    @@@@@@@@@@@@@@@@@@@@            @@@@@@@@@@@@@@@@@@@\n";              
    cout << "     @@@@@@@@@@@@@@@@   @@@@   @@@@  @@@@@@@@@@@@@@@@\n";              
    cout << "                @@@    @@@@@@@@@@@@@   @@@            \n";               
    cout << "    @@@@@@@@@@@@@@@    @@@@@@@@@@@@@   @@@@@@@@@@@@@@@\n"; 
    cout << "                @@@      @@@@@@@@@     @@@            \n";               
    cout << "     @@@@@@@@@@@@@@@       @@@@@      @@@@@@@@@@@@@@@ \n";               
    cout << "   @@@@@@@@@@@@@@@@@@@       @      @@@@@@@@@@@@@@@@@@@\n";              
    cout << "                    @@@@@@@    @@@@@@@                \n";               
    cout << "                         @@@@@@@@@                     \n";               
    cout << "                                                      \n";               
    cout << "            @@@@   @@@@@@  @@@@@   @@@@   @@  @@      \n";               
    cout << "           @@        @@   @@   @@ @@      @@ @@       \n";               
    cout << "            @@@@     @@   @@   @@ @@      @@@@        \n";               
    cout << "               @     @@   @@   @@ @@  @   @@ @@       \n";               
    cout << "           @@@@@     @@    @@@@@   @@@@   @@  @@      \n";
    cout << "                                                      \n";
    cout << "           @@  @@    @@   @@@@@@  @@@@@@  @@@@@       \n";              
    cout << "           @@@@@@   @@@     @@    @@      @@          \n";               
    cout << "           @ @@ @  @@ @@    @@    @@@@@     @@@@      \n";               
    cout << "           @    @  @@@@@    @@    @@      @   @@      \n";               
    cout << "           @    @ @@   @@   @@    @@@@@@   @@@@       \n";               
    cout << "           @    @ @@   @@   @@    @@@@@@   @@@@       \n"; 

    cout << "\n **************";
    cout << "  Name: Armand Link  "; 
    cout << "*************** " << "\n";
    cout << "\t******* " << "Due Date: ";
     
     // Calls Date Method for Due Date
    cout << set_date.PrintDate();              
    cout <<" *******\n\n";
}

// Specification C1 - Alpha Menu
void displayStockMenu() 
{
        cout << "\n\t------------- "; 
        cout << "Main Menu";
        cout << " ------------\n\n";
        cout << "\t\t<A>dd Inventory\n"; 
        cout << "\t\t<D>elete Inventory\n"; 
        cout << "\t\t<E>dit Inventory\n";
        cout << "\t\t<P>rint Inventory\n";
        cout << "\t\t<Q>uit Program\n";
        cout << "\nPlease choose an option (A, D, E, P, or Q to Quit): "; 
}
 
char promptStockMenu(const char* menu_prompt)
{
    char user_choice;
        cout << menu_prompt;
        cin >> user_choice;                     // Grabs single character     
        //cin.get(user_choice);
        cin.ignore(numeric_limits<streamsize>::max(), '\n');                            
        user_choice = toupper(user_choice);     // Converts to Upper Case
        
        return user_choice;                     
}

// Specification B3 - Menu Input Validation
bool validateStockInput(char ch)
{
    return (ch == 'A' || ch == 'D' || ch == 'E' || ch == 'P' || ch == 'Q');
}
char getValidStockOption()
{
    char opt = promptStockMenu("\n\n>");

    while (!validateStockInput(opt))
    {
        cout << "\tINVALID OPTION: PLEASE TRY AGAIN." << endl;
        displayStockMenu();
        opt = promptStockMenu("\n\n>");
    }
    return opt;

}

void UnitTest() 
{
    Date d;
    Stock x;
    Storage h;

    cout << "\t\n\\\\\\\\\\\\\\\\\\\\\\\\///////////////";
    cout << "\\\\\\\\\\\\\\\\\\\\\\\\///////////////" << endl;
    cout << "\n\t\tUnit Test is Running. . .\n";
    cout << "\n\t\tDate Components Status:\n";
    d.TestDate();
    cout << "\n\n\t\tStock Components Status: \n";
    x.StockTest();
    cout << "\n\n\t\tStorage Components Status: \n";
    h.StorageTest();
    cout <<"\t\n\n////////////////\\\\\\\\\\\\\\\\\\\\\\\\";
    cout << "////////////////\\\\\\\\\\\\\\\\\\\\\\\\" << endl;
} 
